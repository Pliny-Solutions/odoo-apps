<?xml version="1.0"?>
<odoo>
    <record id="hr_training_action" model="ir.actions.act_window">
        <field name="name">Training List</field>
        <field name="res_model">hr.training</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a new Training
          </p>
        </field>
    </record>


    <record id="view_hr_training_tree" model="ir.ui.view">
        <field name="name">hr.training.tree</field>
        <field name="model">hr.training</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="employee_id"/>
                <field name="persons_trained"/>
                <field name="training_type"/>
                <field name="trainer_id"/>
            </tree>
        </field>
    </record>

    <!-- The stat button view list -->
    <record id="action_hr_training_trainee" model="ir.actions.act_window">
        <field name="name">Training Attendance</field>
        <field name="res_model">hr.training.trainee</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('employee_id', '=', context.get('search_default_employee_id'))]</field>
    </record>


    <!-- List view by employees and the trainings they have attended -->
    <record id="view_hr_training_trainee_tree_with_training_data" model="ir.ui.view">
        <field name="name">hr.training.trainee.tree.training</field>
        <field name="model">hr.training.trainee</field>
        <field name="arch" type="xml">
            <tree>
                <field name="employee_id"/>
            </tree>
        </field>
    </record>

    <record id="action_hr_training_trainee_with_training" model="ir.actions.act_window">
        <field name="name">Employee Trainings</field>
        <field name="res_model">hr.training.trainee</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_hr_training_trainee_tree_with_training_data"/>
    </record>

    <record id="view_hr_training_trainee_tree" model="ir.ui.view">
      <field name="name">hr.training.trainee.tree</field>
      <field name="model">hr.training.trainee</field>
      <field name="arch" type="xml">
        <tree string="Trainings Attended">
          <field name="employee_id"/>
          <field name="training_id"/>
          <field name="notes"/>
        </tree>
      </field>
    </record>


    <record id="view_hr_training_trainee_kanban" model="ir.ui.view">
      <field name="name">hr.training.trainee.kanban</field>
      <field name="model">hr.training.trainee</field>
      <field name="arch" type="xml">
        <kanban default_group_by="employee_id" class="o_kanban_small_column">
          <field name="employee_id"/>
          <field name="training_id"/>
          <field name="notes"/>

          <templates>
            <t t-name="kanban-box">
              <div class="oe_kanban_global_click">
                <!-- Employee avatar -->
                <div class="o_kanban_image">
                  <field name="employee_id" widget="many2one_avatar_user"/>
                </div>

                <!-- Training name + notes -->
                <div class="o_kanban_details">
                  <div>
                    <field name="training_id"/>
                  </div>
                  <div>
                    <field name="notes"/>
                  </div>
                </div>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>



    <record id="view_hr_training_form" model="ir.ui.view">
        <field name="name">hr.training.form</field>
        <field name="model">hr.training</field>
        <field name="arch" type="xml">
            <form>
            <header>
                <button name="action_approve" string="Approve" type="object" class="btn-primary"/>
                <button name="action_complete" string="Complete" type="object" class="btn-primary"  />
                <button name="action_cancel" string="Cancel" type="object" class="btn-danger" confirm="Are you sure you want to submit this. You cant edit after this?" />
                <button name="action_close" string="Close" type="object" class="btn-danger" confirm="Are you sure you want to submit this. You cant edit after this?" invisible = "state == 'planned'" />
                <field name="state" widget="statusbar" statusbar_visible="planned,approved,ongoing,done,cancelled,closed"/>
            </header>
                            <sheet>
                    <group>
                      <group>
                          <field name="name"/>
                          <field name="start_date" readonly="state == 'closed' or state == 'cancelled'"/>
                          <field name="end_date" readonly="state == 'closed' or state == 'cancelled'"/>
                          <field name="department_id" readonly="state == 'closed' or state == 'cancelled'"/>
                      </group>
                      <group>
                          <field name="training_type" readonly="state == 'closed' or state == 'cancelled'"/>
                          <field name="trainer_id" readonly="state == 'closed' or state == 'cancelled'"/>
                          <field name="employee_id" readonly="state == 'closed' or state == 'cancelled'"/>
                      </group>
                     </group>
                    <group>

                        <field name="description" readonly="state == 'closed' or state == 'cancelled'"/>
                        <field name="objective" readonly="state == 'closed' or state == 'cancelled'"/>
                        <field name="target" readonly="state == 'closed' or state == 'cancelled'"/>
                    </group>
                    <notebook>
                        <page string="Trainees">
                            <field name="trainee_ids"  readonly="state == 'closed' or state == 'cancelled'">
                                 <tree editable="bottom">
                                    <field name="employee_id"/>
                                    <field name="notes"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Attachments" >
                            <field name="attachment_ids" readonly="state == 'closed' or state == 'cancelled'">
                                <tree editable="bottom" >
                                    <field name="name"/>
                                    <field name="attachment_type"/>
                                    <field name="attachment" filename="name" widget="binary" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <menuitem id="hr_training_menu_root" name="Training">

        <menuitem id="hr_training_menu" sequence="1"  name="Training"  action="hr_training_action"/>
        <menuitem id="hr_trainings_employee" sequence="2"  name="Employee List"  action="action_hr_training_trainee_with_training"/>
    </menuitem>

</odoo>
